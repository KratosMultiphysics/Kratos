# Submerged construction of an excavation

This document describes the changes that have been made to the Kratos model compared to the corresponding Plaxis tutorial.


## Mesh

The model's geometry follows the one specified by the Plaxis tutorial.

After generating the mesh in GiD, we first have to make the element IDs of the interface elements unique.  The way we have done that here is to prepend the element IDs of the interface elements on the left hand side with 1, and by prepending the element IDs of the interface elements on the right hand side by a 2.  Don't forget to also update the element IDs of the sub-model parts!

Subsequently, we need to convert the line elements that represent the soil-structure interfaces to actual line interface elements.  To this end, we have written a small Python script (`insert_interfaces_in_excavation_model.py`) that uses the in-house developed interface element inserter.  To convert the line elements to line interface elements, run the following command:
```shell
# Run the following commands in the directory containing the `.mdpa` file
python insert_interfaces_in_excavation_model.py  
```
This script produces a new `.mdpa` file (i.e., it doesn't overwrite the existing one): `submerged_excavation_gid_project_with_interfaces.mdpa`.  Please, be aware that node IDs in sub-model parts that were **not** given to the interface inserter, won't be updated.  This typically occurs for "overarching" sub-model parts that put other sub-model parts together.

The next step is to create master-slave constraints using yet another Python script from the `FEA-Tools` repository:
```shell
python <path-to-FEA-Tools-repo>\MiscellaneousTools\InterfaceInserter\insert_master_slave_constraints.py Clay_Left,Sand_Left Clay_Upper_Right,Clay_Middle_Right,Clay_Lower_Right,Sand_Right submerged_excavation_gid_project_with_interfaces.mdpa 1_Initial_stage.json --search_radius 0.01
```
This script produces two new files: `out_submerged_excavation_gid_project_with_interfaces.mdpa` and `out_1_Initial_stage.json`.  After inspecting the differences between the original files and the new files, we can safely rename the new files to the original file names.

Furthermore, the truss element that has been generated by GiD has three nodes.  We need, however, a 2-noded truss element.  To this end, we have removed the final node ID from the element connectivity and changed the element type name to `LinearTrussElement2D2N`.

For the line load condition (that is being used for the surface load), we had to change its type from `LineLoadCondition2D3N` to `LineLoadDiffOrderCondition2D3N`.  In addition, the end nodes of these conditions had to be swapped.  Prior to swapping, the process that finds neighboring elements would not work, because of the reversed orientations.

For the water pressure conditions, we need to replace the corner node of the clay bottom next to the diaphragm wall with the duplicated node.


## Material properties

GeoMechanicsApplication expects a slightly different set of material properties compared to Plaxis.

In Plaxis, the user needs to provide the unsaturated unit weight $`\gamma_{\mathrm{unsat}}`$ and saturated unit weight $`\gamma_{\mathrm{sat}}`$ of the clay layer as well as the sand layer.  GeoMechanicsApplication, however, expects to receive solid densities and porosity values.  The following formulas show how to calculate the unsaturated unit weight as well as the saturated unit weight:

```math
\begin{matrix}
\gamma_{\mathrm{unsat}} = (1 - n) \cdot \rho_{\mathrm{g}} \cdot g + S_{\mathrm{res}} \cdot n \cdot \rho_{\mathrm{w}} \cdot g \\
\gamma_{\mathrm{sat}}   = (1 - n) \cdot \rho_{\mathrm{g}} \cdot g + S_{\mathrm{sat}} \cdot n \cdot \rho_{\mathrm{w}} \cdot g
\end{matrix}
```

given porosity $`n`$, grain density $`\rho_{\mathrm{g}}`$, residual saturation $`S_{\mathrm{res}}`$, "saturated" saturation $`S_{\mathrm{sat}}`$, water density $`\gamma_{\mathrm{w}}`$, and gravity acceleration $`g`$.

For the initial stage (which uses a $`K_0`$ procedure), we need to assign linear elastic material properties which are defined by a Young's modulus $`E`$ and a Poisson's ratio $`\nu`$.  Since the Plaxis tutorial specifies three different stiffness values (i.e., a secant stiffness in standard drained triaxial test $`E_{50}^{\mathrm{ref}}`$, a tangent stiffness for primary oedometer loading $`E_{\mathrm{oed}}^{\mathrm{ref}}`$, and an unloading / reloading stiffness $`E_{\mathrm{ur}}^{\mathrm{ref}}`$), we have opted for the maximum value of these (being the unloading / reloading stiffness $`E_{\mathrm{ur}}^{\mathrm{ref}}`$).

The following table lists the material properties of the soil layers that have been adopted by the Kratos model.

| Property                                                  | Kratos input parameter | Clay                             | Sand                             | Unit                           |
|-----------------------------------------------------------|------------------------|----------------------------------|----------------------------------|--------------------------------|
| Grain density $`\rho_{\mathrm{g}}`$                       | `DENSITY_SOLID`        | 2038.74                          | 2475.61                          | $`\mathrm{kg} / \mathrm{m}^3`$ |
| Water density $`\rho_{\mathrm{w}}`$                       | `DENSITY_WATER`        | 1019.37                          | 1019.37                          | $`\mathrm{kg} / \mathrm{m}^3`$ |
| Porosity $`n`$                                            | `POROSITY`             | 0.20                             | 0.30                             | $`[-]`$                        |
| Retention law type                                        | `RETENTION_LAW`        | `SaturatedBelowPhreaticLevelLaw` | `SaturatedBelowPhreaticLevelLaw` | N/A                            |
| Residual saturation $`S_{\mathrm{res}}`$                  | `RESIDUAL_SATURATION`  | $`1 \cdot 10^{-10}`$             | $`1 \cdot 10^{-10}`$             | $`[-]`$                        |
| Saturated saturation $`S_{\mathrm{sat}}`$                 | `SATURATED_SATURATION` | 1.0                              | 1.0                              | $`[-]`$                        |
| Young's modulus $`E`$                                     | `YOUNG_MODULUS`        | $`12 \cdot 10^3`$                | $`120 \cdot 10^3`$               | $`\mathrm{kN} / \mathrm{m}^2`$ |
| Poisson's ratio $`\nu`$                                   | `POISSON_RATIO`        | 0.15                             | 0.20                             | $`[-]`$                        |
| Cohesion $`c`$                                            | `GEO_COHESION`         | 1000.0                           | 0.0                              | $`\mathrm{N} / \mathrm{m}^2`$  |
| Friction angle $`\phi`$                                   | `GEO_FRICTION_ANGLE`   | 25.0                             | 32.0                             | $`^{\circ}`$                   |
| Dilatancy angle $`\psi`$                                  | `GEO_DILATANCY_ANGLE`  | 0.0                              | 2.0                              | $`^{\circ}`$                   |
| K0-value for normal consolidation $`K_{\mathrm{0}}^{nc}`$ | `K0_NC`                | 0.5774                           | 0.4701                           | $`[-]`$                        |

The table below is specifically for the material properties of the soils for the Hardening soil (HS) model. For the hardening soil user defined soil model being used in the current model, 21 parameters are expected. These inputs are listed below by order:

| UMAT_PARAMETERS number | Property                                                                     | Clay                 | Sand                 | Unit                           |
|------------------------|------------------------------------------------------------------------------|----------------------|----------------------|--------------------------------|
| 1                      | Secant stiffness in standard drained triaxial test $`E_{\mathrm{50}}^{ref}`$ | $`4 \cdot 10^{3}`$   | $`40 \cdot 10^{3}`$  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 2                      | Tangent stiffness for primary oedometer loading $`E_{\mathrm{oed}}^{ref}`$   | $`3.3 \cdot 10^{3}`$ | $`40 \cdot 10^{3}`$  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 3                      | Unloading / reloading stiffness $`E_{\mathrm{ur}}^{ref}`$                    | $`12 \cdot 10^{3}`$  | $`120 \cdot 10^{3}`$ | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 4                      | Power for stress-level dependency of stiffness $`m`$                         | 1.0                  | 0.5                  | $`[-]`$                        |
| 5                      | Friction angle $`\phi_{\mathrm{peak}}`$                                      | 25.0                 | 32.0                 | $`^{\circ}`$                   |
| 6                      | Dilatancy angle $`\psi_{\mathrm{peak}}`$                                     | 0.0                  | 2.0                  | $`^{\circ}`$                   |
| 7                      | Cohesion $`c'`$                                                              | 1.0                  | 0.0                  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 8                      | Poisson's ratio $`\nu`$                                                      | 0.15                 | 0.2                  | $`[-]`$                        |
| 9                      | Reference stress for stiffnesses $`P_{\mathrm{ref}}`$                        | 100                  | 100                  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 10                     | Failure ratio $`q_{\mathrm{f}}/ q{\mathrm{a}}`$                              | 0.9                  | 0.9                  | $`[-]`$                        |
| 11                     | Tensile strength $`\sigma_{\mathrm{t,} \mathrm{cut-off}}`$                   | 0.0                  | 0.0                  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 12                     | Over-consolidation ratio $`OCR`$                                             | 1.0                  | 1.0                  | $`[-]`$                        |
| 13                     | Pre-overburden pressure $`POP`$                                              | 5.0                  | 0.0                  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 14                     | K0-value for normal consolidation $`K_{\mathrm{0}}^{nc}`$                    | 0.5774               | 0.4701               | $`[-]`$                        |
| 15                     | Unloading Poisson's ratio  $`\nu_{\mathrm{un}} (UMAT)`$                      | 0.15                 | 0.2                  | $`[-]`$                        |
| 16                     | Initial void ration $`e_{\mathrm{0}}`$                                       | 0.25                 | 0.4286               | $`[-]`$                        |
| 17                     | Maximum void ration $`e_{\mathrm{max}}`$                                     | 1.0                  | 1.0                  | $`[-]`$                        |
| 18                     | Flow rule (HS=0, HSSmall=1, Rowe=2, UBC=3)                                   | 0                    | 0                    | $`[-]`$                        |
| 19                     | Initial shear modulus   $`G_{\mathrm{0}}^{ref}`$                             | 0.0                  | 0.0                  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| 20                     | Threshold shear strain $`\gamma_{\mathrm{r}}`$                               | 0.0                  | 0.0                  | $`[-]`$                        |
| 21                     | Controls the shape of the modulus reduction curve $`\alpha_{\mathrm{r}}`$    | 0.0                  | 0.0                  | $`[-]`$                        |

The following table lists the material properties of the interfaces that have been adopted by the Kratos model.

| Property                                 | Kratos input parameter | Clay      | Sand    | Unit                           |
|------------------------------------------|------------------------|-----------|---------|--------------------------------|
| Normal stiffness $`k_{\mathrm{n}}`$      | `NORMAL_STIFFNESS`     | 48000     | 480000  | $`\mathrm{kN} / \mathrm{m}^3`$ |
| Shear stiffness $`k_{\mathrm{s}}`$       | `SHEAR_STIFFNESS`      | 20869.565 | 200000  | $`\mathrm{kN} / \mathrm{m}^3`$ |
| Cohesion $`c`$                           | `GEO_COHESION`         | 1000.0    | 0.0     | $`\mathrm{N} / \mathrm{m}^2`$  |
| Friction angle $`\phi`$                  | `GEO_FRICTION_ANGLE`   | 25.0      | 32.0    | $`^{\circ}`$                   |
| Dilatancy angle $`\psi`$                 | `GEO_DILATANCY_ANGLE`  | 0.0       | 2.0     | $`^{\circ}`$                   |
| Tensile strength $`\sigma_{\mathrm{t}}`$ | `GEO_TENSILE_STRENGTH` | 2.1445    | 0.0     | $`\mathrm{N} / \mathrm{m}^2`$  |

The following table lists the material properties of the diaphragm wall that have been adopted by the Kratos model.

| Property                                       | Kratos input parameter  | Diaphragm wall      | Unit                           |
|------------------------------------------------|-------------------------|---------------------|--------------------------------|
| Young's modulus $`E`$                          | `YOUNG_MODULUS`         | $`5.93 \cdot 10^6`$ | $`\mathrm{kN} / \mathrm{m}^2`$ |
| Poisson's ratio $`\nu`$                        | `POISSON_RATIO`         | 0.0                 | $`[-]`$                        |
| Thickness $`t`$                                | `THICKNESS`             | 1.265               | $`[m]`$                        |
| Effective shear thickness y $`t_{\mathrm{y}}`$ | `THICKNESS_EFFECTIVE_Y` | 0.025               | $`[m]`$                        |
| Density $`\rho`$                               | `DENSITY`               | 1019.368            | $`\mathrm{kg} / \mathrm{m}^3`$ |

The following table lists the material properties of the strut that have been adopted by the Kratos model.

| Property                  | Kratos input parameter | Strut               | Unit                           |
|---------------------------|------------------------|---------------------|--------------------------------|
| Young's modulus $`E`$     | `YOUNG_MODULUS`        | $`2.1 \cdot 10^8`$  | $`\mathrm{kN} / \mathrm{m}^2`$ |
| Density $`\rho`$          | `DENSITY`              |  7850.0             | $`\mathrm{kg} / \mathrm{m}^3`$ |
| Cross-sectional area $`A` | `CROSS_SECTIONAL_AREA` | $`1.9 \cdot 10^-3`$ | $`[m^2]`$                      |
| Truss pre-stress PK2      | `TRUSS_PRESTRESS_PK2`  | 0.0                 | $`\mathrm{kN} / \mathrm{m}^3`$ |


## Staged analysis

This section lists the stages that are taken into account:

1. **Initial stage:**: in this stage, the complete soil domain is active, and the diaphragm wall as well the interfaces at both sides of it are inactive.  Where the soil will later be separated by the diaphragm wall, we will apply master-slave constraints to ensure continuity of the displacement field in this early stage of analysis.  The only load that is being applied is self-weight.  At the end of the stage, a $`K_0`$ procedure is performed to initialize the horizontal stress field.  Note that the $`K_0`$ procedure requires the use of linear elastic materials for all soil parts.
2. **Null step:** in this stage, we will change the material models from linear elastic to hardening soil (or Mohr-Coulomb if we don't have a working hardening soil model at hand).  By changing the material models, we will trigger a stiffness redistribution, and hence a stress redistribution.
3. **Diaphragm wall installation and applying the external load:** in this stage, we activate the diaphragm wall and the interfaces that are attached to its left and right sides.  At the same time, we also need to deactivate the master-slave constraints, since we no longer require the displacement field to be continuous across the entire domain.  In addition, a surface load is applied to a part of the top of the soil on the left hand side.
4. **First excavation stage:** In this stage, the top part of the clay to the right of the diaphragm wall is excavated.  In other words, the corresponding model part is deactivated.  Also, the interface elements that connect the now excavated clay layer to the diaphragm wall need to be deactivated. 
5. **Installation of a strut:** In this stage, we activate the strut.
6. **Second excavation stage:** In this stage, the now top-most part of the clay to the right of the diaphragm wall is excavated.  In other words, the corresponding model part is deactivated.  Also, the interface elements that connect the now excavated clay layer to the diaphragm wall need to be deactivated.  In addition, we need to apply a normal contact stress to the "naked" part of the diaphragm wall as well as the bottom of the excavation pit.
7. **Third excavation stage:** In this final stage, the now top-most part of the clay to the right of the diaphragm wall is excavated.  In other words, the corresponding model part is deactivated.  Also, the interface elements that connect the now excavated clay layer to the diaphragm wall need to be deactivated.  In addition, we need to apply a normal contact stress to the "naked" part of the diaphragm wall as well as the bottom of the excavation pit.